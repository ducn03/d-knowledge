<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Knowledge Base</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" id="highlight-theme">
  <style>
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      height: 100vh;
      background: #f5f6fa;
      overflow: hidden;
      display: flex;
      transition: background 0.3s ease;
    }
    body.dark {
      background: #1f2937;
    }
    /* Sidebar */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      width: 260px;
      background: #fff;
      border-right: 1px solid #eee;
      overflow-y: auto;
      transition: transform 0.3s ease-in-out;
      box-shadow: 2px 0 6px rgba(0,0,0,0.05);
      transform: translateX(-100%);
      z-index: 999;
      display: flex;
      flex-direction: column;
    }
    .sidebar.show { transform: translateX(0); }
    body.dark .sidebar {
      background: #374151;
      border-right: 1px solid #4b5563;
    }

    .sidebar-header {
      padding: 15px;
      text-align: center;
      background: linear-gradient(135deg, #10b981, #34d399);
      color: white;
      font-weight: bold;
      font-size: 1.1rem;
      letter-spacing: 0.5px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .toggle-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #24CB71;
      color: #fff;
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      transition: background 0.3s ease, transform 0.2s ease;
    }
    .toggle-btn:hover {
      background: #1ee47a;
      transform: scale(1.1) rotate(10deg);
    }

    .mode-toggle {
      position: fixed;
      bottom: 80px;
      right: 20px;
      background: #4b5563;
      color: #fff;
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      transition: background 0.3s ease, transform 0.2s ease;
    }
    .mode-toggle:hover {
      background: #6b7280;
      transform: scale(1.1);
    }

    .menu {
      flex: 1;
      padding: 10px 5px;
    }
    .menu ul {
      list-style: none;
      padding-left: 5px;
      margin: 0;
    }
    .menu li {
      cursor: pointer;
      padding: 8px 10px;
      border-radius: 6px;
      transition: all 0.25s ease;
      user-select: none;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 2px;
      color: #374151;
      font-size: 0.95rem;
    }
    body.dark .menu li { color: #e5e7eb; }
    .menu li:hover {
      background: #f0fdf4;
      transform: translateX(4px);
    }
    body.dark .menu li:hover { background: #4b5563; }
    .menu li.active {
      background: linear-gradient(to right, #dcfce7, #ffffff);
      color: #059669;
      font-weight: 600;
      border-left: 3px solid #10b981;
      padding-left: 7px;
    }
    body.dark .menu li.active {
      background: linear-gradient(to right, #4b5563, #374151);
      color: #34d399;
    }

    .submenu {
      display: none;
      padding-left: 10px;
    }
    .submenu.open {
      display: block;
      animation: fadeSlide 0.3s ease;
    }
    @keyframes fadeSlide {
      from { opacity: 0; transform: translateY(-4px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .arrow {
      font-size: 0.75rem;
      color: #666;
      margin-right: 4px;
    }
    body.dark .arrow { color: #9ca3af; }

    .content {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
      transition: all 0.4s ease-in-out;
      width: 100%;
    }
    body.dark .content { background: #111827; }

    .markdown-body {
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      width: 100%;
      margin: auto;
      line-height: 1.6;
      box-sizing: border-box;
      transition: all 0.4s ease-in-out;
    }
    body.dark .markdown-body {
      background: #1f2937;
      color: #e5e7eb;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    /* Laptop/Desktop sidebar */
    @media (min-width: 1024px) {
      body { overflow: hidden; }
      .sidebar { position: relative; transform: translateX(0); transition: margin-left 0.4s ease-in-out; }
      .sidebar.hidden { margin-left: -260px; }
      .content { transition: margin-left 0.4s ease-in-out; }
      .sidebar:not(.hidden) ~ .content .markdown-body {
        max-width: 92%;
        transform: scale(0.97);
        box-shadow: 0 8px 20px rgba(0,0,0,0.06);
      }
      .sidebar.hidden ~ .content .markdown-body {
        max-width: 100%;
        transform: scale(1);
      }
    }

    /* Mobile optimization */
    @media (max-width: 1023px) {
      .content { padding: 10px; }
      .markdown-body {
        padding: 0;
        background: transparent;
        box-shadow: none;
        width: 95%;
        transform: scale(1);
      }
      body.dark .markdown-body {
        background: transparent;
        color: #e5e7eb;
      }
    }

    /* Markdown Styling */
    .markdown-body {
      font-size: 16px;
      color: #111827;
      line-height: 1.75;
      word-wrap: break-word;
    }
    body.dark .markdown-body { color: #e5e7eb; }
    .markdown-body h1,
    .markdown-body h2,
    .markdown-body h3,
    .markdown-body h4,
    .markdown-body h5,
    .markdown-body h6 {
      font-weight: 700;
      margin-top: 1.6em;
      margin-bottom: 0.8em;
      line-height: 1.25;
    }
    .markdown-body h1 {
      font-size: 2rem;
      border-bottom: 2px solid #e5e7eb;
      padding-bottom: 0.3em;
    }
    body.dark .markdown-body h1 { border-bottom: 2px solid #4b5563; }
    .markdown-body h2 {
      font-size: 1.6rem;
      border-left: 4px solid #10b981;
      padding-left: 10px;
    }
    .markdown-body h3 { font-size: 1.3rem; }
    .markdown-body h4 { font-size: 1.1rem; }
    .markdown-body h5, .markdown-body h6 { font-size: 1rem; color: #374151; }
    body.dark .markdown-body h5, body.dark .markdown-body h6 { color: #d1d5db; }

    .markdown-body p {
      margin: 0.8em 0;
      color: #374151;
    }
    body.dark .markdown-body p { color: #d1d5db; }
    .markdown-body a {
      color: #10b981;
      text-decoration: none;
      font-weight: 500;
    }
    body.dark .markdown-body a { color: #34d399; }
    .markdown-body a:hover { text-decoration: underline; }

    .markdown-body blockquote {
      margin: 1.2em 0;
      padding: 0.9em 1em;
      border-left: 4px solid #10b981;
      background: #f0fdf4;
      color: #065f46;
      border-radius: 8px;
      font-style: italic;
    }
    body.dark .markdown-body blockquote {
      background: #374151;
      color: #d1d5db;
      border-left: 4px solid #34d399;
    }

    .markdown-body ul, .markdown-body ol {
      padding-left: 1.4em;
      margin: 0.8em 0;
    }
    .markdown-body li { margin: 0.4em 0; }

    .markdown-body pre {
      background: #f9fafb;
      color: #1f2937;
      padding: 1em;
      border-radius: 8px;
      overflow-x: auto;
      margin: 1em 0;
      position: relative;
    }
    body.dark .markdown-body pre {
      background: #374151;
      color: #e5e7eb;
    }
    .markdown-body code {
      background: #f3f4f6;
      padding: 0.2em 0.4em;
      border-radius: 4px;
      font-size: 0.95em;
      font-family: 'Fira Code', monospace;
      color: #db2777;
    }
    body.dark .markdown-body code {
      background: #4b5563;
      color: #f472b6;
    }
    .markdown-body pre code {
      background: transparent;
      padding: 0;
      border-radius: 0;
      color: inherit;
      font-size: 0.95em;
    }

    .markdown-body table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.2em 0;
      border-radius: 6px;
      overflow: hidden;
    }
    .markdown-body th, .markdown-body td {
      border: 1px solid #e5e7eb;
      padding: 10px 14px;
      text-align: left;
    }
    body.dark .markdown-body th, body.dark .markdown-body td {
      border: 1px solid #4b5563;
    }
    .markdown-body th {
      background: #f9fafb;
      font-weight: 600;
    }
    body.dark .markdown-body th {
      background: #4b5563;
    }
    .markdown-body tr:nth-child(even) { background: #f3f4f6; }
    body.dark .markdown-body tr:nth-child(even) { background: #374151; }
    .markdown-body tr:hover { background: #ecfdf5; }
    body.dark .markdown-body tr:hover { background: #4b5563; }

    .copy-button {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #10b981;
      color: #fff;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s ease;
    }
    .copy-button:hover {
      background: #059669;
    }
    body.dark .copy-button {
      background: #34d399;
    }
    body.dark .copy-button:hover {
      background: #10b981;
    }
  </style>
</head>
<body>
  <button class="toggle-btn" id="toggleBtn">â˜°</button>
  <button class="mode-toggle" id="modeToggle">ðŸŒ™</button>
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">My Knowledge Base</div>
    <div id="menu" class="menu"></div>
  </div>
  <div class="content">
    <div id="content" class="markdown-body"></div>
  </div>

  <script>
  const sidebar = document.getElementById('sidebar');
  const toggleBtn = document.getElementById('toggleBtn');
  const modeToggle = document.getElementById('modeToggle');
  const menuDiv = document.getElementById('menu');
  const contentDiv = document.getElementById('content');
  const highlightTheme = document.getElementById('highlight-theme');

  // HÃ m build URL cho fetch (cháº¡y Ä‘Æ°á»£c cáº£ local láº«n GitHub Pages)
  function getFileUrl(path) {
    // Loáº¡i bá» dáº¥u / á»Ÿ Ä‘áº§u náº¿u cÃ³ Ä‘á»ƒ Ä‘áº£m báº£o Ä‘Æ°á»ng dáº«n tÆ°Æ¡ng Ä‘á»‘i
    const cleanPath = path.replace(/^\/+/, '');
    if (location.protocol === 'file:') {
      // Local: tráº£ vá» Ä‘Æ°á»ng dáº«n tÆ°Æ¡ng Ä‘á»‘i tá»« thÆ° má»¥c gá»‘c
      return cleanPath;
    } else {
      // GitHub Pages: thÃªm basePath (thÆ° má»¥c chá»©a index.html)
      const basePath = window.location.pathname.replace(/\/[^\/]*$/, '');
      return `${basePath}/${cleanPath}`;
    }
  }

  // Toggle sidebar
  toggleBtn.addEventListener('click', () => {
    if (window.innerWidth < 1024) {
      sidebar.classList.toggle('show');
    } else {
      sidebar.classList.toggle('hidden');
    }
  });

  // Toggle dark/light mode
  modeToggle.addEventListener('click', () => {
    document.body.classList.toggle('dark');
    modeToggle.textContent = document.body.classList.contains('dark') ? 'â˜€ï¸' : 'ðŸŒ™';
    highlightTheme.href = document.body.classList.contains('dark')
      ? 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css'
      : 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css';
    localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
  });

  // Load saved theme
  if (localStorage.getItem('theme') === 'dark') {
    document.body.classList.add('dark');
    modeToggle.textContent = 'â˜€ï¸';
    highlightTheme.href = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css';
  }

  // Query param helper
  function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
  }
  function setQueryParam(param, value) {
    const url = new URL(window.location);
    url.searchParams.set(param, value);
    window.history.pushState({}, '', url);
  }

  // Activate menu item
  function activateMenuItem(path) {
    document.querySelectorAll('.menu li').forEach(el => el.classList.remove('active'));
    const target = Array.from(document.querySelectorAll('.menu li'))
      .find(item => item.dataset.path === path);
    if (target) {
      target.classList.add('active');
      let parent = target.parentNode;
      while (parent && parent.classList.contains('submenu')) {
        parent.classList.add('open');
        parent.previousElementSibling.querySelector('.arrow').textContent = 'â–¾';
        parent = parent.parentNode.closest('.submenu');
      }
    }
  }

  let structureData = {};

  // Load structure.json (universal)
  fetch(getFileUrl('structure_vi.json'))
    .then(res => {
      if (!res.ok) throw new Error(`KhÃ´ng táº£i Ä‘Æ°á»£c structure_vi.json: ${res.statusText}`);
      return res.json();
    })
    .then(data => {
      structureData = data;
      const menu = buildMenu(data);
      menu.classList.add('submenu', 'open');
      menuDiv.appendChild(menu);

      const path = getQueryParam('path') || 'intro.md';
      loadMarkdown(path);
      activateMenuItem(path);
    })
    .catch(err => {
      console.error('Lá»—i khi táº£i structure_vi.json:', err);
      contentDiv.innerHTML = `<p style="color:red">Lá»—i táº£i cáº¥u trÃºc menu: ${err.message}</p>`;
    });

  function buildMenu(obj) {
    const ul = document.createElement('ul');
    for (const key in obj) {
      const li = document.createElement('li');

      if (typeof obj[key] === 'string') {
        li.textContent = key;
        li.dataset.path = obj[key];
        li.addEventListener('click', () => {
          document.querySelectorAll('.menu li').forEach(el => el.classList.remove('active'));
          li.classList.add('active');
          loadMarkdown(obj[key]);
          setQueryParam('path', obj[key]);
          if (window.innerWidth < 1024) sidebar.classList.remove('show');
        });
      } else {
        const arrow = document.createElement('span');
        arrow.textContent = 'â–¸';
        arrow.className = 'arrow';

        const span = document.createElement('span');
        span.textContent = key;

        const header = document.createElement('div');
        header.style.display = 'flex';
        header.style.alignItems = 'center';
        header.appendChild(arrow);
        header.appendChild(span);
        li.appendChild(header);

        const subMenu = buildMenu(obj[key]);
        subMenu.classList.add('submenu');
        li.appendChild(subMenu);

        header.addEventListener('click', (e) => {
          const siblingSubmenus = li.parentNode.querySelectorAll('.submenu.open');
          siblingSubmenus.forEach(sub => {
            if (sub !== subMenu) {
              sub.classList.remove('open');
              sub.previousElementSibling.querySelector('.arrow').textContent = 'â–¸';
            }
          });
          subMenu.classList.toggle('open');
          arrow.textContent = subMenu.classList.contains('open') ? 'â–¾' : 'â–¸';
          e.stopPropagation();
        });
      }
      ul.appendChild(li);
    }
    return ul;
  }

  // Load markdown (universal)
  function loadMarkdown(path) {
    fetch(getFileUrl(path))
      .then(res => {
        if (!res.ok) throw new Error(`KhÃ´ng tÃ¬m tháº¥y file: ${path}`);
        return res.text();
      })
      .then(md => {
        contentDiv.innerHTML = marked.parse(md);
        hljs.highlightAll();
        addCopyButtons();
      })
      .catch(err => {
        console.error('Lá»—i khi táº£i Markdown:', err);
        contentDiv.innerHTML = `<p style="color:red">${err.message}</p>`;
      });
  }

  function addCopyButtons() {
    const codeBlocks = document.querySelectorAll('pre');
    codeBlocks.forEach((block) => {
      if (block.querySelector('.copy-button')) return;
      const copyButton = document.createElement('button');
      copyButton.textContent = 'Copy';
      copyButton.className = 'copy-button';
      block.appendChild(copyButton);

      copyButton.addEventListener('click', () => {
        const code = block.querySelector('code').textContent;
        navigator.clipboard.writeText(code).then(() => {
          copyButton.textContent = 'Copied!';
          setTimeout(() => { copyButton.textContent = 'Copy'; }, 2000);
        }).catch(err => {
          console.error('Copy failed:', err);
        });
      });
    });
  }
</script>
</body>
</html>